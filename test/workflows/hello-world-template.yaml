apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: hello-world-template
  namespace: argo
  labels:
    workflows.argoproj.io/archive-strategy: "false"
  annotations:
    workflows.argoproj.io/description: |
      This is a simple hello world example.
spec:
  entrypoint: whalesay
  serviceAccountName: argo-workflow
  templates:
  - name: whalesay
    container:
      image: registry1.dso.mil/ironbank/opensource/postgres/postgresql-alpine:15.6
      command: ["/bin/bash", "-c"]
      args:
        - |
          echo "this is an artifact test" > /tmp/artifact.txt
    outputs:
      artifacts:
        - name: temp-artifact
          path: /tmp/artifact.txt
          s3:
            key: /tmp/artifact.txt
          artifactGC:
            strategy: Never
    metadata:
      annotations:
        proxy.istio.io/config: '{ "holdApplicationUntilProxyStarts": true }'
  podMetadata:
    annotations:
      workflows.argoproj.io/kill-cmd-istio-proxy: '["pilot-agent", "request", "POST", "quitquitquit"]'
